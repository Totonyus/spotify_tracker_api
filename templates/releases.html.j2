<html>
<head>
    <title>Releases - Spotify Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
    <link rel="icon" type="image/png" href="/static/favicon.ico" />

    <style>
        {% if app_params.get('search_url_music') == '' %}
            .search_icon {
                display: none;
            }
        {% endif %}
    </style>
</head>

<body>
<span class="header">
    <span class="category_number">{{ releases | length }} releases (from {{ artists | length }} <a
            class="api_link_reference" href="/artists">/artists</a>)</span>
    {% if metadata == None %}
        <span class="category_item warning"><span>No analysis performed yet</span> âž¤
                <span><a class="api_link_reference" href="/refresh">/refresh</a></span></span>
    {% else %}
        {% if status == None %}
            <span class="category_item {{ 'error' if outdated }}"><span>Last scan : {{ metadata.last_execution }} </span> âž¤
                    <span><a class="api_link_reference" href="/refresh">/refresh</a></span></span>

            {% if metadata.last_execution_timestamp != metadata.last_successful_execution_timestamp %}
                <span class="category_item {{ 'error' if outdated }}"><span>Last successful scan : {{ metadata.last_successful_execution }} </span> âž¤
                    <span><a class="api_link_reference" href="/refresh">/refresh</a></span></span>
            {% endif %}
        {% else %}
            <span class="category_item"><span>Running scan</span> âž¤ <span>{{ status.get('current_artist') + status.get('current_show') }} on {{ status.get('total_artists') + status.get('total_shows') }}</span></span>
        {% endif %}
    {% endif %}
</span>

<span class="main_container">
{% if reverse_sort %}
    {% set releases = releases | sort(attribute=sort_by) | reverse %}
{% else %}
    {% set releases = releases | sort(attribute=sort_by) %}
{% endif %}

    {% for release in releases %}
        <span class='album_row'>
        <span class='album_cover_col'>
            <a target="_blank" href="{{ release.external_urls.spotify }}">
                <img alt="{{ release.name }}" class='album_cover' src='{{ release.images[1].url }}'/>
            </a>
        </span>
        <span class='album_info_col'>
            <span class='album_name'>
                <a href="{{ release.external_urls.spotify }}"> {{ release .name }} </a>
                <a target="_blank" class="search_icon"
                   href="{{ app_params.get('search_url_music') | replace('{}', (release.name | urlencode) ) }}">ðŸ”Ž</a>
            </span>
            <span class='album_information'>{{ release.release_date }} - {{ release.album_type }} ({{ release.total_tracks }}ðŸŽµ)</span>
            <span class='album_artists'>
                {% for artist in release.artists %}
                    <span class="artist">
                        <a target="_blank" href="{{ artist.external_urls.spotify }}"> {{ artist.name }} </a>
                        <a target="_blank" class="search_icon"
                           href="{{ app_params.get('search_url_music') | replace('{}', (artist.name | urlencode) ) }}">ðŸ”Ž</a>
                    </span>
                {% endfor %}
            </span>
        </span>
    </span>
        <hr class="dashed"/>
    {% endfor %}
</span>
</body>
</html>